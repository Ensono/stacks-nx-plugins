# ESLint Flat Config Schema

**Feature**: 001-eslint-flat-config  
**Date**: 3 February 2026

## Overview

This document defines the expected structure of ESLint flat configuration files
generated by Stacks plugins.

## Root Configuration Schema

The root `eslint.config.js` file exported by `@ensono-stacks/workspace:init`:

```typescript
/**
 * Root ESLint flat configuration for Stacks workspaces.
 *
 * @example
 * // eslint.config.js
 * import stacksConfig from './eslint.config.js';
 * export default stacksConfig;
 */
interface StacksRootConfig {
    /**
     * Global ignores applied to all configuration objects.
     * Excludes build outputs, dependencies, and generated files.
     */
    globalIgnores: string[];

    /**
     * Base JavaScript/TypeScript configuration including:
     * - @eslint/js recommended rules
     * - typescript-eslint recommended rules
     * - Prettier integration
     */
    baseConfig: ConfigObject[];

    /**
     * Nx-specific configuration including:
     * - Module boundary enforcement
     * - Workspace-aware import resolution
     */
    nxConfig: ConfigObject[];

    /**
     * Plugin configurations for:
     * - eslint-plugin-import (import ordering)
     * - eslint-plugin-security (security rules)
     * - eslint-plugin-unicorn (code style)
     */
    pluginConfigs: ConfigObject[];

    /**
     * Test file configuration for:
     * - Jest environment globals
     * - Testing library rules
     */
    testConfig: ConfigObject[];
}
```

## Generated Root Config Example

```javascript
// eslint.config.js (generated by @ensono-stacks/workspace:init)
import { defineConfig, globalIgnores } from 'eslint/config';
import js from '@eslint/js';
import tseslint from 'typescript-eslint';
import nxPlugin from '@nx/eslint-plugin';
import importPlugin from 'eslint-plugin-import';
import securityPlugin from 'eslint-plugin-security';
import unicornPlugin from 'eslint-plugin-unicorn';
import prettierConfig from 'eslint-plugin-prettier/recommended';
import globals from 'globals';

export default defineConfig([
    // Name for debugging
    { name: 'stacks/global-ignores' },

    // Global ignores
    globalIgnores([
        '**/dist/',
        '**/node_modules/',
        '**/.nx/',
        '**/coverage/',
        '**/.next/',
        '**/tmp/',
    ]),

    // Base JS config
    {
        name: 'stacks/base-js',
        ...js.configs.recommended,
    },

    // TypeScript config
    ...tseslint.configs.recommended.map(config => ({
        ...config,
        name: `stacks/typescript/${config.name || 'base'}`,
    })),

    // Nx module boundaries
    {
        name: 'stacks/nx-boundaries',
        plugins: { '@nx': nxPlugin },
        rules: {
            '@nx/enforce-module-boundaries': [
                'error',
                {
                    enforceBuildableLibDependency: true,
                    allow: [],
                    depConstraints: [
                        { sourceTag: '*', onlyDependOnLibsWithTags: ['*'] },
                    ],
                },
            ],
        },
    },

    // Import plugin
    {
        name: 'stacks/import-rules',
        ...importPlugin.flatConfigs.recommended,
        settings: {
            'import/resolver': {
                typescript: {
                    project: 'tsconfig.base.json',
                },
            },
        },
        rules: {
            'import/order': [
                'error',
                {
                    groups: [
                        ['builtin', 'external'],
                        ['internal'],
                        ['parent', 'sibling', 'index'],
                    ],
                    alphabetize: { order: 'asc' },
                    'newlines-between': 'always',
                },
            ],
            'import/no-extraneous-dependencies': 'off',
            'import/prefer-default-export': 'off',
        },
    },

    // Security plugin
    {
        name: 'stacks/security-rules',
        ...securityPlugin.configs.recommended,
        rules: {
            'security/detect-object-injection': 'off',
            'security/detect-non-literal-fs-filename': 'off',
        },
    },

    // Unicorn plugin
    {
        name: 'stacks/unicorn-rules',
        ...unicornPlugin.configs['flat/recommended'],
        rules: {
            'unicorn/no-array-reduce': 'off',
            'unicorn/no-null': 'off',
            'unicorn/prefer-module': 'off',
            'unicorn/filename-case': 'off',
            'unicorn/no-array-for-each': 'off',
            'unicorn/no-for-loop': 'off',
            'unicorn/prevent-abbreviations': [
                'error',
                {
                    allowList: {
                        getServerSideProps: true,
                        getStaticProps: true,
                        args: true,
                    },
                    replacements: {
                        env: { environment: false },
                        prod: { production: false },
                    },
                    ignore: ['^e2e', 'e2e$'],
                },
            ],
        },
    },

    // Prettier integration
    {
        name: 'stacks/prettier',
        ...prettierConfig,
    },

    // TypeScript-specific rules
    {
        name: 'stacks/typescript-rules',
        files: ['**/*.ts', '**/*.tsx'],
        languageOptions: {
            parser: tseslint.parser,
            parserOptions: {
                projectService: true,
                tsconfigRootDir: import.meta.dirname,
            },
            globals: {
                ...globals.node,
            },
        },
        rules: {
            '@typescript-eslint/no-var-requires': 'off',
            '@typescript-eslint/no-empty-function': 'off',
            '@typescript-eslint/no-explicit-any': 'off',
            '@typescript-eslint/ban-ts-comment': 'off',
            '@typescript-eslint/no-use-before-define': 'error',
            '@typescript-eslint/no-shadow': 'error',
            'no-shadow': 'off',
            'no-use-before-define': 'off',
        },
    },

    // Test files
    {
        name: 'stacks/test-files',
        files: [
            '**/*.spec.ts',
            '**/*.spec.tsx',
            '**/*.test.ts',
            '**/*.test.tsx',
        ],
        languageOptions: {
            globals: {
                ...globals.jest,
            },
        },
        rules: {
            // Relaxed rules for tests
        },
    },

    // JSON files
    {
        name: 'stacks/json-files',
        files: ['**/*.json'],
        languageOptions: {
            parser: jsoncParser,
        },
        rules: {
            'unicorn/prevent-abbreviations': 'off',
        },
    },
]);
```

## Project Configuration Schema

Project-level `eslint.config.js` files extend the root config:

```javascript
// packages/<project>/eslint.config.js
import baseConfig from '../../eslint.config.js';
import { defineConfig } from 'eslint/config';

export default defineConfig([
    ...baseConfig,

    // Project-specific overrides
    {
        name: '<project>/overrides',
        files: ['**/*.ts', '**/*.tsx'],
        rules: {
            // Project-specific rule overrides
        },
    },
]);
```

## Next.js Project Configuration

The `@ensono-stacks/next:init` generator adds Next.js-specific configuration:

```javascript
// apps/<next-app>/eslint.config.js
import baseConfig from '../../eslint.config.js';
import { defineConfig } from 'eslint/config';
import nextPlugin from '@next/eslint-plugin-next';
import testingLibrary from 'eslint-plugin-testing-library';

export default defineConfig([
    ...baseConfig,

    // Next.js plugin
    {
        name: 'next/recommended',
        plugins: { '@next/next': nextPlugin },
        rules: {
            ...nextPlugin.configs.recommended.rules,
            ...nextPlugin.configs['core-web-vitals'].rules,
        },
    },

    // Testing Library for React
    {
        name: 'next/testing-library',
        files: [
            '**/*.spec.ts',
            '**/*.spec.tsx',
            '**/*.test.ts',
            '**/*.test.tsx',
        ],
        ...testingLibrary.configs['flat/react'],
        rules: {
            'testing-library/await-async-utils': 'error',
            'testing-library/await-async-queries': 'error',
            'testing-library/no-wait-for-side-effects': 'error',
            'testing-library/no-manual-cleanup': 'error',
            'testing-library/prefer-explicit-assert': 'warn',
            'testing-library/prefer-presence-queries': 'warn',
            'testing-library/prefer-user-event': 'warn',
            'testing-library/no-debug': 'off',
        },
    },

    // Next.js specific ignores
    {
        name: 'next/ignores',
        ignores: ['.next/**/*'],
    },
]);
```

## Validation Requirements

Generated configurations must:

1. Export a valid flat config array
2. Use ESM syntax (`import`/`export`)
3. Include named config objects for debugging
4. Follow cascading order (base → plugins → overrides)
5. Work with `nx lint` command
6. Pass ESLint's own validation
