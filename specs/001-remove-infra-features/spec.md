# Feature Specification: Remove Infrastructure Features

**Feature Branch**: `001-remove-infra-features`  
**Created**: 2 February 2026  
**Status**: Draft  
**Input**: User description: "remove any and all features related to infrastructure. there should be no init-deployment generators."

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Developer Generates Plugin Without Deployment Options (Priority: P1)

As a developer using Ensono Stacks Nx plugins, I want the plugins to focus purely on application code generation without infrastructure concerns, so that I can use my own deployment strategies and infrastructure tooling.

**Why this priority**: This is the core value proposition - allowing developers to use Stacks plugins for code scaffolding without being locked into specific infrastructure patterns (Azure DevOps, Terraform). This simplifies the plugin API and reduces maintenance burden.

**Independent Test**: Can be fully tested by running any generator and verifying no infrastructure-related files (pipelines, Terraform configs, deployment YAMLs) are created. The generated application code should work independently of any CI/CD platform.

**Acceptance Scenarios**:

1. **Given** a developer runs `@ensono-stacks/playwright:init`, **When** the generator completes, **Then** no Azure DevOps pipeline files, Terraform files, or deployment YAML files are created
2. **Given** a developer lists available generators for any plugin, **When** they view the generator list, **Then** no `init-deployment` or `*-deployment` generators appear
3. **Given** a developer has previously used infrastructure generators, **When** they upgrade to the new version, **Then** existing infrastructure files remain untouched (no breaking changes to existing projects)

---

### User Story 2 - Developer Uses Simplified Stacks Configuration (Priority: P2)

As a developer setting up a new Stacks workspace, I want the configuration to focus only on application-level settings, so that I don't need to provide infrastructure details like Terraform backend storage or pipeline configuration.

**Why this priority**: Simplifying the configuration reduces onboarding friction and makes the plugins accessible to teams using different infrastructure approaches.

**Independent Test**: Can be tested by creating a new Stacks workspace and verifying that no `terraform` or `pipeline` configuration options are required or prompted.

**Acceptance Scenarios**:

1. **Given** a developer runs `@ensono-stacks/create-stacks-workspace`, **When** prompted for configuration, **Then** no questions about Terraform backend, pipeline provider, or deployment settings appear
2. **Given** a developer reads the Stacks configuration in `nx.json`, **When** they examine the `stacks.config` object, **Then** no `terraform` or `pipeline` properties exist

---

### User Story 3 - Maintainer Works with Cleaner Codebase (Priority: P3)

As a plugin maintainer, I want infrastructure-related code removed from the codebase, so that the plugins are easier to maintain and have a smaller surface area.

**Why this priority**: Reducing code complexity improves maintainability and allows the team to focus on core functionality.

**Independent Test**: Can be tested by verifying that infrastructure-related directories, files, and exports no longer exist in the package source code.

**Acceptance Scenarios**:

1. **Given** a maintainer examines the playwright package, **When** they list the generators directory, **Then** no `init-deployment` or `visual-regression-deployment` directories exist
2. **Given** a maintainer reviews the package exports, **When** they check `src/index.ts` files, **Then** no deployment-related generators are exported
3. **Given** a maintainer runs the test suite, **When** all tests complete, **Then** no tests reference removed infrastructure functionality

---

### Edge Cases

- What happens when a user has an existing workspace with infrastructure files generated by previous versions? **Assumption**: Existing files are left untouched; migration is out of scope.
- How does the removal affect E2E tests that currently test deployment generators? **Assumption**: E2E tests for removed generators should be deleted.
- What happens to documentation referencing infrastructure features? **Assumption**: Documentation updates are part of this feature scope.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: The `@ensono-stacks/playwright` plugin MUST NOT include the `init-deployment` generator
- **FR-002**: The `@ensono-stacks/playwright` plugin MUST NOT include the `visual-regression-deployment` generator
- **FR-003**: All `*-deployment` generator source files MUST be removed from the `packages/playwright/src/generators/` directory
- **FR-004**: The `generators.json` file for playwright MUST NOT reference any deployment generators
- **FR-005**: The `src/index.ts` exports MUST NOT include any deployment-related generator exports
- **FR-006**: The Stacks configuration schema MUST NOT require `terraform` properties
- **FR-007**: The Stacks configuration schema MUST NOT require `pipeline` properties
- **FR-008**: The `@ensono-stacks/create` package MUST NOT prompt for or accept infrastructure-related options (terraform, pipeline)
- **FR-009**: Test utilities in `@ensono-stacks/test` MUST be updated to remove infrastructure-related default values
- **FR-010**: E2E utilities in `@ensono-stacks/e2e` MUST be updated to remove infrastructure-related command options
- **FR-011**: Documentation in `CONTRIBUTING.md` and `.github/copilot-instructions.md` MUST be updated to remove references to `init-deployment` generators
- **FR-012**: Unit tests for removed generators MUST be deleted
- **FR-013**: E2E tests for deployment functionality MUST be deleted or updated

### Key Entities

- **Generators**: The plugin generators registered in `generators.json` - deployment generators should be removed
- **Stacks Configuration**: The `stacks.config` object in `nx.json` - should no longer contain `terraform` or `pipeline` properties
- **Package Exports**: The public API exposed via `src/index.ts` - should not export deployment generators

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Zero deployment-related generators appear when running `nx list @ensono-stacks/playwright`
- **SC-002**: Running any `@ensono-stacks/*:init` generator creates zero pipeline or infrastructure files
- **SC-003**: 100% of tests pass after infrastructure code removal
- **SC-004**: The Stacks workspace creation process completes without requiring infrastructure configuration inputs
- **SC-005**: All documentation accurately reflects the removal of infrastructure features (zero references to removed functionality)
- **SC-006**: Plugin package size is reduced by removing infrastructure-related code and templates

## Assumptions

- Existing infrastructure files in user workspaces are not modified or migrated - users who need these files retain responsibility for them
- The `azure-node` and `azure-react` plugins are unaffected as they provide Azure SDK integration (App Insights), not deployment infrastructure
- The removal is a breaking change that will be communicated via release notes and semantic versioning (major version bump if applicable)
- The `@ensono-stacks/workspace:init` generator remains as it configures the workspace for Stacks, not deployment infrastructure

